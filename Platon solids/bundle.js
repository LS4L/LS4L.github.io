!function(t){"use strict";class i{constructor(t=0,i=0){this.x=t,this.y=i}add(t){return new i(this.x+t.x,this.y+t.y)}sub(t){return new i(this.x-t.x,this.y-t.y)}mul(t){return new i(this.x*t,this.y*t)}div(t){return new i(this.x/t,this.y/t)}neg(){return new i(-this.x,-this.y)}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}len2(){return this.x*this.x+this.y*this.y}len(){return Math.sqrt(this.len2())}normalize(){return this.div(this.len())}lerp(t,r){return new i(this.x+(t.x-this.x)*r,this.y+(t.y-this.y)*r)}}class r{constructor(t=0,i=0,r=0){this.x=t,this.y=i,this.z=r}add(t){return new r(this.x+t.x,this.y+t.y,this.z+t.z)}sub(t){return new r(this.x-t.x,this.y-t.y,this.z-t.z)}mul(t){return new r(this.x*t,this.y*t,this.z*t)}div(t){return 0!=t?new r(this.x/t,this.y/t,this.z/t):new r}neg(){return new r(-this.x,-this.y,-this.z)}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}cross(t){return new r(this.y*t.z-this.z*t.y,this.z*t.x-this.x*t.z,this.x*t.y-this.y*t.x)}len2(){return this.x*this.x+this.y*this.y+this.z*this.z}len(){return Math.sqrt(this.len2())}normalize(){return this.div(this.len())}lerp(t,i){return new r(this.x+(t.x-this.x)*i,this.y+(t.y-this.y)*i,this.z+(t.z-this.z)*i)}mulMatr(t){let i=this.x*t[0][3]+this.y*t[1][3]+this.z*t[2][3]+t[3][3];return new r((this.x*t[0][0]+this.y*t[1][0]+this.z*t[2][0]+t[3][0])/i,(this.x*t[0][1]+this.y*t[1][1]+this.z*t[2][1]+t[3][1])/i,(this.x*t[0][2]+this.y*t[1][2]+this.z*t[2][2]+t[3][2])/i)}angle(t){return 0==t.len2()||0==this.len2()?0:Math.acos(this.dot(t)/(this.len()*t.len()))}get xxx(){return new r(this.x,this.x,this.x)}get yyy(){return new r(this.y,this.y,this.y)}get zzz(){return new r(this.z,this.z,this.z)}}class e{constructor(t=0,i=0,r=0,e=0){this.x=t,this.y=i,this.z=r,this.w=e}add(t){return new e(this.x+t.x,this.y+t.y,this.z+t.z,this.w+t.w)}sub(t){return new e(this.x-t.x,this.y-t.y,this.z-t.z,this.w-t.w)}mul(t){return new e(this.x*t,this.y*t,this.z*t,this.w*t)}div(t){return new e(this.x/t,this.y/t,this.z/t,this.w/t)}neg(){return new e(-this.x,-this.y,-this.z,-this.w)}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*this.w}len2(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}len(){return Math.sqrt(this.len2())}normalize(){return this.div(this.len())}lerp(t,i){return new r(this.x+(t.x-this.x)*i,this.y+(t.y-this.y)*i,this.z+(t.z-this.z)*i,this.w+(t.w-this.w)*i)}}class s{constructor(t=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]]){this[0]=[],this[1]=[],this[2]=[],this[3]=[],this[0][0]=t[0][0],this[0][1]=t[0][1],this[0][2]=t[0][2],this[0][3]=t[0][3],this[1][0]=t[1][0],this[1][1]=t[1][1],this[1][2]=t[1][2],this[1][3]=t[1][3],this[2][0]=t[2][0],this[2][1]=t[2][1],this[2][2]=t[2][2],this[2][3]=t[2][3],this[3][0]=t[3][0],this[3][1]=t[3][1],this[3][2]=t[3][2],this[3][3]=t[3][3]}a(){return[[this[0][0],this[0][1],this[0][2],this[0][3]],[this[1][0],this[1][1],this[1][2],this[1][3]],[this[2][0],this[2][1],this[2][2],this[2][3]],[this[3][0],this[3][1],this[3][2],this[3][3]]]}translate(t){return new s([[1,0,0,0],[0,1,0,0],[0,0,1,0],[t.x,t.y,t.z,1]])}scale(t){return new s([[t.x,0,0,0],[0,t.y,0,0],[0,0,t.z,0],[0,0,0,1]])}rotateX(t){let i=new s,r=t/180*Math.PI,e=Math.sin(r),n=Math.cos(r);return i[1][1]=n,i[2][2]=n,i[1][2]=e,i[2][1]=-e,i}rotateY(t){let i=new s,r=t/180*Math.PI,e=Math.sin(r),n=Math.cos(r);return i[0][0]=n,i[2][2]=n,i[0][2]=-e,i[2][0]=e,i}rotateZ(t){let i=new s,r=t/180*Math.PI,e=Math.sin(r),n=Math.cos(r);return i[0][0]=n,i[1][1]=n,i[0][1]=e,i[1][0]=-e,i}rotate(t,i){let r=t/180*Math.PI,e=Math.sin(r),n=Math.cos(r);return new s([[n+i.x*i.x*(1-n),i.x*i.y*(1-n)+i.z*e,i.x*i.z*(1-n)-i.y*e,0],[i.y*i.x*(1-n)-i.z*e,n+i.y*i.y*(1-n),i.y*i.z*(1-n)+i.x*e,0],[i.z*i.x*(1-n)+i.y*e,i.z*i.y*(1-n)-i.x*e,n+i.z*i.z*(1-n),0],[0,0,0,1]])}transpose(){let t=new s;return t[0][0]=this[0][0],t[0][1]=this[1][0],t[0][2]=this[2][0],t[0][3]=this[3][0],t[1][0]=this[0][1],t[1][1]=this[1][1],t[1][2]=this[2][1],t[1][3]=this[3][1],t[2][0]=this[0][2],t[2][1]=this[1][2],t[2][2]=this[2][2],t[2][3]=this[3][2],t[3][0]=this[0][3],t[3][1]=this[1][3],t[3][2]=this[2][3],t[3][3]=this[3][3],t}determ3x3(t,i,r,e,s,n,h,o,a){return t*s*a+i*n*h+r*e*o-t*n*o-i*e*a-r*s*h}determ(){return+this[0][0]*this.determ3x3(this[1][1],this[1][2],this[1][3],this[2][1],this[2][2],this[2][3],this[3][1],this[3][2],this[3][3])+-this[0][1]*this.determ3x3(this[1][0],this[1][2],this[1][3],this[2][0],this[2][2],this[2][3],this[3][0],this[3][2],this[3][3])+ +this[0][2]*this.determ3x3(this[1][0],this[1][1],this[1][3],this[2][0],this[2][1],this[2][3],this[3][0],this[3][1],this[3][3])+-this[0][3]*this.determ3x3(this[1][0],this[1][1],this[1][2],this[2][0],this[2][1],this[2][2],this[3][0],this[3][1],this[3][2])}inverse(){let t=this.determ(),i=new s;return 0==t?new s:(i[0][0]=+this.determ3x3(this[1][1],this[1][2],this[1][3],this[2][1],this[2][2],this[2][3],this[3][1],this[3][2],this[3][3])/t,i[1][0]=-this.determ3x3(this[1][0],this[1][2],this[1][3],this[2][0],this[2][2],this[2][3],this[3][0],this[3][2],this[3][3])/t,i[2][0]=+this.determ3x3(this[1][0],this[1][1],this[1][3],this[2][0],this[2][1],this[2][3],this[3][0],this[3][1],this[3][3])/t,i[3][0]=-this.determ3x3(this[1][0],this[1][1],this[1][2],this[2][0],this[2][1],this[2][2],this[3][0],this[3][1],this[3][2])/t,i[0][1]=-this.determ3x3(this[0][1],this[0][2],this[0][3],this[2][1],this[2][2],this[2][3],this[3][1],this[3][2],this[3][3])/t,i[1][1]=+this.determ3x3(this[0][0],this[0][2],this[0][3],this[2][0],this[2][2],this[2][3],this[3][0],this[3][2],this[3][3])/t,i[2][1]=-this.determ3x3(this[0][0],this[0][1],this[0][3],this[2][0],this[2][1],this[2][3],this[3][0],this[3][1],this[3][3])/t,i[3][1]=+this.determ3x3(this[0][0],this[0][1],this[0][2],this[2][0],this[2][1],this[2][2],this[3][0],this[3][1],this[3][2])/t,i[0][2]=+this.determ3x3(this[0][1],this[0][2],this[0][3],this[1][1],this[1][2],this[1][3],this[3][1],this[3][2],this[3][3])/t,i[1][2]=-this.determ3x3(this[0][0],this[0][2],this[0][3],this[1][0],this[1][2],this[1][3],this[3][0],this[3][2],this[3][3])/t,i[2][2]=+this.determ3x3(this[0][0],this[0][1],this[0][3],this[1][0],this[1][1],this[1][3],this[3][0],this[3][1],this[3][3])/t,i[3][2]=-this.determ3x3(this[0][0],this[0][1],this[0][2],this[1][0],this[1][1],this[1][2],this[3][0],this[3][1],this[3][2])/t,i[0][3]=-this.determ3x3(this[0][1],this[0][2],this[0][3],this[1][1],this[1][2],this[1][3],this[2][1],this[2][2],this[2][3])/t,i[1][3]=+this.determ3x3(this[0][0],this[0][2],this[0][3],this[1][0],this[1][2],this[1][3],this[2][0],this[2][2],this[2][3])/t,i[2][3]=-this.determ3x3(this[0][0],this[0][1],this[0][3],this[1][0],this[1][1],this[1][3],this[2][0],this[2][1],this[2][3])/t,i[3][3]=+this.determ3x3(this[0][0],this[0][1],this[0][2],this[1][0],this[1][1],this[1][2],this[2][0],this[2][1],this[2][2])/t,i)}add(t){let i=new s;return i[0][0]=this[0][0]+t[0][0],i[0][1]=this[0][1]+t[0][1],i[0][2]=this[0][2]+t[0][2],i[0][3]=this[0][3]+t[0][3],i[1][0]=this[1][0]+t[1][0],i[1][1]=this[1][1]+t[1][1],i[1][2]=this[1][2]+t[1][2],i[1][3]=this[1][3]+t[1][3],i[2][0]=this[2][0]+t[2][0],i[2][1]=this[2][1]+t[2][1],i[2][2]=this[2][2]+t[2][2],i[2][3]=this[2][3]+t[2][3],i[3][0]=this[3][0]+t[3][0],i[3][1]=this[3][1]+t[3][1],i[3][2]=this[3][2]+t[3][2],i[3][3]=this[3][3]+t[3][3],i}mul(t){let i=new s;return i[0][0]=this[0][0]*t[0][0]+this[0][1]*t[1][0]+this[0][2]*t[2][0]+this[0][3]*t[3][0],i[0][1]=this[0][0]*t[0][1]+this[0][1]*t[1][1]+this[0][2]*t[2][1]+this[0][3]*t[3][1],i[0][2]=this[0][0]*t[0][2]+this[0][1]*t[1][2]+this[0][2]*t[2][2]+this[0][3]*t[3][2],i[0][3]=this[0][0]*t[0][3]+this[0][1]*t[1][3]+this[0][2]*t[2][3]+this[0][3]*t[3][3],i[1][0]=this[1][0]*t[0][0]+this[1][1]*t[1][0]+this[1][2]*t[2][0]+this[1][3]*t[3][0],i[1][1]=this[1][0]*t[0][1]+this[1][1]*t[1][1]+this[1][2]*t[2][1]+this[1][3]*t[3][1],i[1][2]=this[1][0]*t[0][2]+this[1][1]*t[1][2]+this[1][2]*t[2][2]+this[1][3]*t[3][2],i[1][3]=this[1][0]*t[0][3]+this[1][1]*t[1][3]+this[1][2]*t[2][3]+this[1][3]*t[3][3],i[2][0]=this[2][0]*t[0][0]+this[2][1]*t[1][0]+this[2][2]*t[2][0]+this[2][3]*t[3][0],i[2][1]=this[2][0]*t[0][1]+this[2][1]*t[1][1]+this[2][2]*t[2][1]+this[2][3]*t[3][1],i[2][2]=this[2][0]*t[0][2]+this[2][1]*t[1][2]+this[2][2]*t[2][2]+this[2][3]*t[3][2],i[2][3]=this[2][0]*t[0][3]+this[2][1]*t[1][3]+this[2][2]*t[2][3]+this[2][3]*t[3][3],i[3][0]=this[3][0]*t[0][0]+this[3][1]*t[1][0]+this[3][2]*t[2][0]+this[3][3]*t[3][0],i[3][1]=this[3][0]*t[0][1]+this[3][1]*t[1][1]+this[3][2]*t[2][1]+this[3][3]*t[3][1],i[3][2]=this[3][0]*t[0][2]+this[3][1]*t[1][2]+this[3][2]*t[2][2]+this[3][3]*t[3][2],i[3][3]=this[3][0]*t[0][3]+this[3][1]*t[1][3]+this[3][2]*t[2][3]+this[3][3]*t[3][3],i}view(t,i,r){let e=i.sub(t).normalize(),n=e.cross(r).normalize(),h=n.cross(e);return new s([[n.x,h.x,-e.x,0],[n.y,h.y,-e.y,0],[n.z,h.z,-e.z,0],[-t.dot(n),-t.dot(h),t.dot(e),1]])}ortho(t,i,r,e,n,h){return new s([[2/(i-t),0,0,0],[0,2/(e-r),0,0],[0,0,-2/(h-n),0],[-(i+t)/(i-t),-(e+r)/(e-r),-(h+n)/(h-n),1]])}frustum(t,i,r,e,n,h){return new s([[2*n/(i-t),0,0,0],[0,2*n/(e-r),0,0],[(i+t)/(i-t),(e+r)/(e-r),-(h+n)/(h-n),-1],[0,0,-2*n*h/(h-n),0]])}}let n=[],h={x:0,y:0,savedX:0,savedY:0,zoom:1,dx:0,dy:0,dz:0,isDown:!1,isRDown:!1},o=new class{constructor(){this.projSize=.1,this.projDist=.1,this.projFarClip=18e3,this.frameW=30,this.frameH=30,this.matrView=new s,this.matrProj=new s,this.matrVP=new s,this.setDef()}camSet(t,i,e){let n=new s;return this.matrView=n.view(t,i,e),this.loc=t,this.at=i,this.dir=new r(-this.matrView[0][2],-this.matrView[1][2],-this.matrView[2][2]),this.up=new r(this.matrView[0][1],this.matrView[1][1],this.matrView[2][1]),this.right=new r(this.matrView[0][0],this.matrView[1][0],this.matrView[2][0]),this.matrVP=this.matrView.mul(this.matrProj),this}setProj(t,i,r){let e,n;e=n=t,this.projDist=i,this.projSize=t,this.projFarClip=r,this.frameW>this.frameH?e*=this.FrameW/this.frameH:n*=this.frameH/this.frameW;let h=new s;return this.matrProj=h.frustum(-e/2,e/2,-n/2,n/2,i,r),this.matrVP=this.matrView.mul(this.matrProj),this}rotate(t,i){let r,e,n,h=new s;return h=h.rotate(i,t),r=this.loc.mulMatr(h),e=this.up.mulMatr(h),n=this.at.mulMatr(h),this.camSet(r,n,e),this}setSize(t,i){return this.frameW=t,this.frameH=i,this.setProj(this.projSize,this.projDist,this.projFarClip),this}setDef(){return this.loc=new r(0,0,1),this.at=new r(0,0,0),this.dir=new r(0,0,-1),this.up=new r(0,1,0),this.right=new r(1,0,0),this.projDist=.1,this.projSize=.1,this.projFarClip=1e4,this.frameW=30,this.frameH=30,this.camSet(this.loc,this.at,this.up),this.setProj(this.projSize,this.projDist,this.projFarClip),this.setSize(this.frameW,this.frameH),this}};function a(t){h.dx=t.pageX-h.x,h.dy=t.pageY-h.y,h.x=t.pageX,h.y=t.pageY}function l(t){0==t.button?h.isDown=!0:2==t.button&&(h.isRDown=!0)}function _(t){0==t.button?h.isDown=!1:2==t.button&&(h.isRDown=!1)}o.camSet(new r(18,10,10),new r(0,8,-5),new r(0,1,0)),o.camSet(new r(62,-16,67),new r(28,39,-6),new r(0,1,0));let g=1;function $(){let t;o.loc=o.loc.add(o.dir.mul(-(.01*h.dz))),t=new s,o.loc=o.loc.mulMatr(t.rotate(.05*h.isDown*h.dx,o.up.neg())),o.loc=o.loc.mulMatr(t.rotate(.05*h.isDown*h.dy,o.right.neg())),o.at=o.at.sub(o.loc),o.at=o.at.mulMatr(t.rotate(.05*h.isRDown*h.dx,o.up)),o.at=o.at.add(o.loc),o.right=o.right.mulMatr(t.rotateY(.05*h.isRDown*h.dx)),o.at=o.at.sub(o.loc),o.at=o.at.mulMatr(t.rotate(.05*h.isRDown*h.dy,o.right)),o.at=o.at.add(o.loc),g+=n.Shift?10:0,o.loc=o.loc.add(o.dir.mul(!!n.w*!n.Control*g)).sub(o.dir.mul(!!n.s*!n.Control*g)).sub(o.right.mul(!!n.a*!n.Control*g)).add(o.right.mul(!!n.d*!n.Control*g)),o.at=o.at.add(o.dir.mul(!!n.w*!n.Control*g)).sub(o.dir.mul(!!n.s*!n.Control*g)).sub(o.right.mul(!!n.a*!n.Control*g)).add(o.right.mul(!!n.d*!n.Control*g)),g-=n.Shift?10:0}function m(t,i=null){let e=[],s=0;null==i&&(i=[...Array(t.length/3).keys()]);for(let n=0;n<t.length;n+=3)e[s++]=new r(t[n],t[n+1],t[n+2]);let h=[];for(let o=0;o<e.length;o++)h[o]=new r;for(let a=0;a<i.length;a+=3){let l=e[i[a]],_=e[i[a+1]],g=e[i[a+2]],$=_.sub(l).cross(g.sub(l)).normalize();h[i[a]]=h[i[a]].add($),h[i[a+1]]=h[i[a+1]].add($),h[i[a+2]]=h[i[a+2]].add($)}for(let m=0;m<e.length;m++)h[m]=h[m].normalize();s=0;let f=[];for(let u=0;u<h.length;u++)f[s++]=h[u].x,f[s++]=h[u].y,f[s++]=h[u].z;return f}let f=[];class u{constructor(t,i,r){this.vs=t,this.fs=i,this.shaderProgram=r}}async function d(i=null){let r,e,s;if(null==i)return f[0];function n(t,i,r){let e=t.createShader(i);return t.shaderSource(e,r),t.compileShader(e,r),e}let h=fetch(`bin/shaders/${i}/vert.glsl`).then(t=>t.text()).then(t=>{r=t}),o=fetch(`bin/shaders/${i}/frag.glsl`).then(t=>t.text()).then(t=>{e=t}),a=Promise.all([h,o]);return await a.then(()=>{let i=n(t.gl,t.gl.VERTEX_SHADER,r),h=n(t.gl,t.gl.FRAGMENT_SHADER,e),o=t.gl.createProgram();if(t.gl.attachShader(o,i),t.gl.attachShader(o,h),t.gl.linkProgram(o),!t.gl.getProgramParameter(o,t.gl.LINK_STATUS)){let a=t.gl.getProgramInfoLog(o);console.log(a)}s=new u(r,e,o),f.push(s)}),s}function c(i,r,e=null,s=null){let n=t.gl.getAttribLocation(i.shaderProgram,"in_pos"),h=t.gl.createBuffer();t.gl.bindBuffer(t.gl.ARRAY_BUFFER,h),t.gl.bufferData(t.gl.ARRAY_BUFFER,r,t.gl.STATIC_DRAW),t.gl.enableVertexAttribArray(n),t.gl.vertexAttribPointer(n,3,t.gl.FLOAT,!1,0,0);let o=t.gl.getAttribLocation(i.shaderProgram,"normal"),a=t.gl.createBuffer();if(t.gl.bindBuffer(t.gl.ARRAY_BUFFER,a),null==s&&(s=new Float32Array(m(r,e))),t.gl.bufferData(t.gl.ARRAY_BUFFER,s,t.gl.STATIC_DRAW),t.gl.enableVertexAttribArray(o),t.gl.vertexAttribPointer(o,3,t.gl.FLOAT,!1,0,0),null!=e){let l=t.gl.createBuffer();t.gl.bindBuffer(t.gl.ELEMENT_ARRAY_BUFFER,l),t.gl.bufferData(t.gl.ELEMENT_ARRAY_BUFFER,e,t.gl.STATIC_DRAW)}}let w=new Float32Array([1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,1,1,-1,1,-1,-1,-1,-1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,-1,1,-1,1,1,-1,1,-1,-1,-1,-1,-1]),x=new Uint16Array([0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]),y,P;function L(){t.gl.useProgram(P.shaderProgram);let i=t.gl.getUniformLocation(P.shaderProgram,"time"),r=t.gl.getUniformLocation(P.shaderProgram,"projection"),e=t.gl.getUniformLocation(P.shaderProgram,"modelView"),n=t.gl.getUniformLocation(P.shaderProgram,"world");t.gl.bindVertexArray(y),t.gl.uniformMatrix4fv(r,!1,new Float32Array(o.matrProj.a().join().split(",")));let h=new s;t.gl.uniformMatrix4fv(n,!1,new Float32Array(h.a().join().split(","))),t.gl.uniformMatrix4fv(e,!1,new Float32Array(o.matrView.a().join().split(","))),t.gl.uniform1f(i,Date.now());let a=t.gl.getUniformLocation(P.shaderProgram,"lightDir"),l=t.gl.getUniformLocation(P.shaderProgram,"camLoc");t.gl.uniform3f(a,1,2,3),t.gl.uniform3f(l,o.loc.x,o.loc.y,o.loc.z);let _=t.gl.getUniformLocation(P.shaderProgram,"ka"),g=t.gl.getUniformLocation(P.shaderProgram,"kd"),$=t.gl.getUniformLocation(P.shaderProgram,"ks"),m=t.gl.getUniformLocation(P.shaderProgram,"ph");t.gl.uniform3f(_,.0215,.1745,.0215),t.gl.uniform3f(g,.07568,.61424,.07568),t.gl.uniform3f($,.633,.727811,.633),t.gl.uniform1f(m,76.8),t.gl.drawElements(t.gl.TRIANGLES,36,t.gl.UNSIGNED_SHORT,0)}async function p(){P=await d("rainbow"),y=t.gl.createVertexArray(),t.gl.bindVertexArray(y),c(P,w,x),t.gl.bindVertexArray(null)}let E=new Float32Array([1,1,1,1,-1,-1,-1,1,-1,-1,-1,1]),U=new Uint16Array([0,3,1,0,2,3,0,1,2,3,2,1]),A,b;function R(){t.gl.useProgram(b.shaderProgram);let i=t.gl.getUniformLocation(b.shaderProgram,"time"),e=t.gl.getUniformLocation(b.shaderProgram,"projection"),n=t.gl.getUniformLocation(b.shaderProgram,"modelView"),h=t.gl.getUniformLocation(b.shaderProgram,"world");t.gl.bindVertexArray(A),t.gl.uniformMatrix4fv(e,!1,new Float32Array(o.matrProj.a().join().split(","))),t.gl.uniformMatrix4fv(n,!1,new Float32Array(o.matrView.a().join().split(",")));let a=new s;t.gl.uniformMatrix4fv(h,!1,new Float32Array(a.rotateZ(Date.now()/30).mul(a.translate(new r(0,3,0))).a().join().split(",")));let l=t.gl.getUniformLocation(b.shaderProgram,"lightDir"),_=t.gl.getUniformLocation(b.shaderProgram,"camLoc");t.gl.uniform1f(i,Date.now()),t.gl.uniform3f(l,1,2,3),t.gl.uniform3f(_,o.loc.x,o.loc.y,o.loc.z);let g=t.gl.getUniformLocation(b.shaderProgram,"ka"),$=t.gl.getUniformLocation(b.shaderProgram,"kd"),m=t.gl.getUniformLocation(b.shaderProgram,"ks"),f=t.gl.getUniformLocation(b.shaderProgram,"ph");t.gl.uniform3f(g,.24725,.2245,.0645),t.gl.uniform3f($,.34615,.3143,.0903),t.gl.uniform3f(m,.797357,.723991,.208006),t.gl.uniform1f(f,83.2),t.gl.drawElements(t.gl.TRIANGLES,12,t.gl.UNSIGNED_SHORT,0)}async function z(){b=await d("withLight"),A=t.gl.createVertexArray(),t.gl.bindVertexArray(A),c(b,E,U),t.gl.bindVertexArray(null)}let v=new Float32Array([1,0,0,0,1,0,0,0,1,-1,0,0,0,-1,0,0,0,-1]),T=new Uint16Array([0,1,2,0,2,4,4,2,3,3,2,1,5,1,0,5,0,4,5,4,3,5,3,1]),S,D;function F(){t.gl.useProgram(D.shaderProgram);let i=t.gl.getUniformLocation(D.shaderProgram,"time"),e=t.gl.getUniformLocation(D.shaderProgram,"projection"),n=t.gl.getUniformLocation(D.shaderProgram,"modelView"),h=t.gl.getUniformLocation(D.shaderProgram,"lightDir"),a=t.gl.getUniformLocation(D.shaderProgram,"camLoc"),l=t.gl.getUniformLocation(D.shaderProgram,"world");t.gl.bindVertexArray(S),t.gl.uniformMatrix4fv(e,!1,new Float32Array(o.matrProj.a().join().split(","))),t.gl.uniformMatrix4fv(n,!1,new Float32Array(o.matrView.a().join().split(",")));let _=new s;t.gl.uniform1f(i,Date.now()),t.gl.uniform3f(h,1,2,3),t.gl.uniform3f(a,o.loc.x,o.loc.y,o.loc.z),t.gl.uniformMatrix4fv(l,!1,new Float32Array(_.rotateY(180*Math.sin(Date.now()/1e3)).mul(_.translate(new r(3,0,0))).a().join().split(",")));let g=t.gl.getUniformLocation(D.shaderProgram,"ka"),$=t.gl.getUniformLocation(D.shaderProgram,"kd"),m=t.gl.getUniformLocation(D.shaderProgram,"ks"),f=t.gl.getUniformLocation(D.shaderProgram,"ph");t.gl.uniform3f(g,.05375,.05,.06625),t.gl.uniform3f($,.18275,.17,.22525),t.gl.uniform3f(m,.332741,.328634,.346435),t.gl.uniform1f(f,38.4),t.gl.drawElements(t.gl.TRIANGLES,24,t.gl.UNSIGNED_SHORT,0)}async function V(){D=await d("withLight"),S=t.gl.createVertexArray(),t.gl.bindVertexArray(S),c(D,v,T),t.gl.bindVertexArray(null)}let j=new Float32Array([0,1,1.6180339887,1,1.6180339887,0,1.6180339887,0,1,0,-1,1.6180339887,-1,1.6180339887,0,1.6180339887,0,-1,0,1,-1.6180339887,1,-1.6180339887,0,-1.6180339887,0,1,0,-1,-1.6180339887,-1,-1.6180339887,0,-1.6180339887,0,-1]),B=new Uint16Array([0,2,1,0,1,4,0,4,8,0,8,3,0,3,2,11,8,4,11,4,6,11,6,9,11,9,10,11,10,9,7,3,10,7,10,9,7,9,5,7,5,2,7,2,3,2,5,1,1,5,6,5,6,9,10,3,8,1,4,6]),k,I;function M(){t.gl.useProgram(I.shaderProgram);let i=t.gl.getUniformLocation(I.shaderProgram,"time"),e=t.gl.getUniformLocation(I.shaderProgram,"projection"),n=t.gl.getUniformLocation(I.shaderProgram,"modelView"),h=t.gl.getUniformLocation(I.shaderProgram,"world");t.gl.bindVertexArray(k),t.gl.uniformMatrix4fv(e,!1,new Float32Array(o.matrProj.a().join().split(","))),t.gl.uniformMatrix4fv(n,!1,new Float32Array(o.matrView.a().join().split(",")));let a=new s;t.gl.uniformMatrix4fv(h,!1,new Float32Array(a.rotateX(Date.now()/10).mul(a.translate(new r(-3,0,0))).a().join().split(",")));let l=t.gl.getUniformLocation(I.shaderProgram,"camLoc"),_=t.gl.getUniformLocation(I.shaderProgram,"lightDir");t.gl.uniform3f(_,1,1,1),t.gl.uniform3f(l,o.loc.x,o.loc.y,o.loc.z);let g=t.gl.getUniformLocation(I.shaderProgram,"ka"),$=t.gl.getUniformLocation(I.shaderProgram,"kd"),m=t.gl.getUniformLocation(I.shaderProgram,"ks"),f=t.gl.getUniformLocation(I.shaderProgram,"ph");t.gl.uniform3f(g,Math.sin(Date.now()/500)/4+.25,Math.cos(Date.now()/300)/4+.25,Math.sin(Date.now()/1e3+5)/4+.25),t.gl.uniform3f($,.07568,.61424,.07568),t.gl.uniform3f(m,.633,.727811,.633),t.gl.uniform1f(f,76.8),t.gl.uniform1f(i,Date.now()),t.gl.drawElements(t.gl.TRIANGLES,60,t.gl.UNSIGNED_SHORT,0)}async function N(){I=await d("withLight"),k=t.gl.createVertexArray(),t.gl.bindVertexArray(k),c(I,j,B),t.gl.bindVertexArray(null)}let H=[];class C{constructor(t=new r(.25,.25,.25),i=new r(.4,.4,.4),e=new r(.774597,.774597,.774597),s=76.8,n=null,h=[null]){this.ka=t,this.kd=i,this.ks=e,this.ph=s,this.shaderName=n,this.tex=[...h]}}function Y(t){let i=t.target.files[0],r=new FileReader;r.readAsText(i),r.onload=t=>{G(t.target.result).then(t=>H.push(t))},r.onerror=function(){console.log(r.error)}}async function G(t){let i=[0],e=[],s=[0],n=t.split("\n");for(let h=0;h<n.length;h++){let o=n[h].split(" ");if("v"==o[0]){let a=+o[1],l=+o[2],_=+o[3];i.push(new r(a,l,_))}else if("f"==o[0])e.push(+o[1].split("/")[0]),e.push(+o[2].split("/")[0]),e.push(+o[3].split("/")[0]);else if("vn"==o[0]){let g=+o[1],$=+o[2],f=+o[3];s.push(new r(g,$,f))}}0==s.length&&(s=m(i,e));let u=[];i.forEach((t,i)=>u.push(new W(t,s[i])));let d=new X(u,e);return d.mtl=new C,d.mtl.shaderName="withLight",await d.create(),d}class W{constructor(t=new r,s=new r,n=new i,h=new e){this.p=t,this.n=s,this.t=n,this.c=h}}class X{constructor(i,r=null,e=0,n=new s,h=t.gl.TRIANGLES,o=null){this.va=o,this.mtl=e,this.vBuf=i,this.iBuf=r,this.trans=n,this.type=h}draw(i){t.gl.useProgram(this.shader.shaderProgram);let r=t.gl.getUniformLocation(this.shader.shaderProgram,"time"),e=t.gl.getUniformLocation(this.shader.shaderProgram,"projection"),s=t.gl.getUniformLocation(this.shader.shaderProgram,"modelView"),n=t.gl.getUniformLocation(this.shader.shaderProgram,"lightDir"),h=t.gl.getUniformLocation(this.shader.shaderProgram,"camLoc"),a=t.gl.getUniformLocation(this.shader.shaderProgram,"world");t.gl.bindVertexArray(this.va),t.gl.uniformMatrix4fv(e,!1,new Float32Array(o.matrProj.a().join().split(","))),t.gl.uniformMatrix4fv(s,!1,new Float32Array(o.matrView.a().join().split(","))),t.gl.uniform1f(r,Date.now()),t.gl.uniform3f(n,1,2,3),t.gl.uniform3f(h,o.loc.x,o.loc.y,o.loc.z),t.gl.uniformMatrix4fv(a,!1,new Float32Array(i.a().join().split(",")));let l=t.gl.getUniformLocation(this.shader.shaderProgram,"ka"),_=t.gl.getUniformLocation(this.shader.shaderProgram,"kd"),g=t.gl.getUniformLocation(this.shader.shaderProgram,"ks"),$=t.gl.getUniformLocation(this.shader.shaderProgram,"ph");t.gl.uniform3f(l,this.mtl.ka.x,this.mtl.ka.y,this.mtl.ka.z),t.gl.uniform3f(_,this.mtl.kd.x,this.mtl.kd.y,this.mtl.kd.z),t.gl.uniform3f(g,this.mtl.ks.x,this.mtl.ks.y,this.mtl.ks.z),t.gl.uniform1f($,this.mtl.ph),null!=this.iBuf?t.gl.drawElements(t.gl.TRIANGLES,this.iBuf.length,t.gl.UNSIGNED_SHORT,0):t.gl.drawArrays(t.gl.type,0,this.vBuf.length)}async create(){this.shader=await d(this.mtl.shaderName),this.va=t.gl.createVertexArray(),t.gl.bindVertexArray(this.va),c(this.shader,new Float32Array(this.vBuf.map(t=>[t.p.x,t.p.y,t.p.z]).flat()),new Uint16Array(this.iBuf),new Float32Array(this.vBuf.map(t=>[t.n.x,t.n.y,t.n.z]).flat())),t.gl.bindVertexArray(null)}}function O(){H.forEach(t=>t.draw(t.trans))}async function Z(){}let q=new Float32Array([10,-5,10,-10,-5,-10,10,-5,-10,10,-5,10,-10,-5,10,-10,-5,-10]),K,J,Q;function tt(){t.gl.useProgram(J.shaderProgram);let i=t.gl.getUniformLocation(J.shaderProgram,"time"),e=t.gl.getUniformLocation(J.shaderProgram,"projection"),n=t.gl.getUniformLocation(J.shaderProgram,"modelView"),h=t.gl.getUniformLocation(J.shaderProgram,"world");t.gl.bindVertexArray(K),t.gl.uniformMatrix4fv(e,!1,new Float32Array(o.matrProj.a().join().split(","))),t.gl.uniformMatrix4fv(n,!1,new Float32Array(o.matrView.a().join().split(",")));let a=new s;t.gl.uniformMatrix4fv(h,!1,new Float32Array(a.translate(new r(-3,0,0)).a().join().split(",")));let l=t.gl.getUniformLocation(J.shaderProgram,"camLoc"),_=t.gl.getUniformLocation(J.shaderProgram,"lightDir");t.gl.uniform3f(_,1,1,1),t.gl.uniform3f(l,o.loc.x,o.loc.y,o.loc.z);let g=t.gl.getUniformLocation(J.shaderProgram,"ka"),$=t.gl.getUniformLocation(J.shaderProgram,"kd"),m=t.gl.getUniformLocation(J.shaderProgram,"ks"),f=t.gl.getUniformLocation(J.shaderProgram,"ph");t.gl.uniform3f(g,.01,.3,.1),t.gl.uniform3f($,.07568,.61424,.07568),t.gl.uniform3f(m,.633,.727811,.633),t.gl.uniform1f(f,76.8),t.gl.uniform1f(i,Date.now()),t.gl.drawArrays(t.gl.TRIANGLES,0,6)}async function ti(){J=await d("withLight"),K=t.gl.createVertexArray(),t.gl.bindVertexArray(K),c(J,q),t.gl.bindVertexArray(null)}let tr,te=new s;function ts(){Q.mtl.ka.x=Math.sin(Date.now()/100),Q.draw(te.scale(new r(1*(Math.sin(Date.now()/500)+2),1*(Math.cos(Date.now()/200)+2),1*(Math.sin(Date.now()/300+5)+2))).mul(te.translate(new r(0,-3,0))))}async function tn(){let t,i=fetch("bin/models/dode.obj").then(t=>t.text()).then(i=>{t=i});await i.then(()=>{G(t).then(t=>Q=t)})}let th=new s,to=1;function ta(){if(to){tr.draw(th.scale(new r(.2*(Math.sin(Date.now()/200)/5+1.2),.2*(Math.cos(Date.now()/300)/5+1.2),.2*(Math.sin(Date.now()/400+5)/5+1.2))).mul(th.translate(new r(0,-3,0))).mul(th.translate(new r(-10,0,0))));for(let t=0;t<1600;t++)tr.mtl.ka=new r(.4*(Math.sin(Date.now()/200+t)/5+1.2),.4*(Math.cos(Date.now()/300+t)/5+1.2),.4*(Math.sin(Date.now()/400+5+t)/5+1.2)),tr.draw(th.scale(new r(.2*(Math.sin(Date.now()/200+t)/5+1.2),.2*(Math.cos(Date.now()/300+t)/5+1.2),.2*(Math.sin(Date.now()/400+5+t)/5+1.2))).mul(th.translate(new r(0,5*Math.floor(t/40),-t%40*5))))}}async function tl(){let t;await fetch("bin/models/cow1.obj").then(t=>t.text()).then(i=>{t=i}).catch(()=>to=0),(tr=await G(t)).mtl.shaderName="withLightSmooth",await tr.create()}let t_,tg,t$,tm=[],t1=document.getElementById("rcoeff"),tf=document.getElementById("gcoeff"),t0=document.getElementById("bcoeff"),tu=document.getElementById("a"),td=document.getElementById("b"),tc,tw,tx,ty,tP,tL=Date.now();function tp(){t.gl.disable(t.gl.DEPTH_TEST),t.gl.bindFramebuffer(t.gl.FRAMEBUFFER,tx),t.gl.viewport(0,0,tc,tw),t.gl.bindVertexArray(t$),t.gl.useProgram(t_.shaderProgram);let i=t.gl.getUniformLocation(t_.shaderProgram,"time"),r=t.gl.getUniformLocation(t_.shaderProgram,"x"),e=t.gl.getUniformLocation(t_.shaderProgram,"y"),s=t.gl.getUniformLocation(t_.shaderProgram,"zoom"),n=t.gl.getUniformLocation(t_.shaderProgram,"rcoeff"),h=t.gl.getUniformLocation(t_.shaderProgram,"gcoeff"),a=t.gl.getUniformLocation(t_.shaderProgram,"bcoeff"),l=t.gl.getUniformLocation(t_.shaderProgram,"a"),_=t.gl.getUniformLocation(t_.shaderProgram,"b");t.gl.uniform1f(i,(Date.now()-tL)/1e3),t.gl.uniform1f(e,.4),t.gl.uniform1f(r,.4),t.gl.uniform1f(s,1),t.gl.uniform1f(n,t1.value),t.gl.uniform1f(h,tf.value),t.gl.uniform1f(a,t0.value),t.gl.uniform1f(l,tu.value),t.gl.uniform1f(_,5*td.value),t.gl.useProgram(t_.shaderProgram),t.gl.drawArrays(t.gl.TRIANGLE_STRIP,0,4),t.gl.useProgram(tg.shaderProgram);let g=t.gl.getUniformLocation(tg.shaderProgram,"tex0");t.gl.bindFramebuffer(t.gl.FRAMEBUFFER,null),t.gl.viewport(0,0,Math.max(t.gl.canvas.width,t.gl.canvas.height),Math.max(t.gl.canvas.width,t.gl.canvas.height)),t.gl.activeTexture(t.gl.TEXTURE0+6),t.gl.bindTexture(t.gl.TEXTURE_2D,ty),t.gl.uniform1i(g,6);let $=t.gl.getUniformLocation(tg.shaderProgram,"camDir"),m=t.gl.getUniformLocation(tg.shaderProgram,"camUp"),f=t.gl.getUniformLocation(tg.shaderProgram,"camRight"),u=t.gl.getUniformLocation(tg.shaderProgram,"projDist"),d=t.gl.getUniformLocation(tg.shaderProgram,"frameW"),c=t.gl.getUniformLocation(tg.shaderProgram,"frameH");t.gl.uniform3f($,o.dir.x,o.dir.y,o.dir.z),t.gl.uniform3f(m,o.up.x,o.up.y,o.up.z),t.gl.uniform3f(f,o.right.x,o.right.y,o.right.z),t.gl.uniform1f(u,o.projDist),t.gl.uniform1f(d,o.frameW),t.gl.uniform1f(c,o.frameH),t.gl.useProgram(tg.shaderProgram),t.gl.drawArrays(t.gl.TRIANGLE_STRIP,0,4),t.gl.enable(t.gl.DEPTH_TEST)}async function tE(){t$=t.gl.createVertexArray(),t.gl.bindVertexArray(t$),t_=await d("mandelbrot"),tm=[-1,-1,0,-1,1,0,1,-1,0,1,1,0];let i=t.gl.getAttribLocation(t_.shaderProgram,"in_pos"),r=t.gl.createBuffer();t.gl.bindBuffer(t.gl.ARRAY_BUFFER,r),t.gl.bufferData(t.gl.ARRAY_BUFFER,new Float32Array(tm),t.gl.STATIC_DRAW),t.gl.enableVertexAttribArray(i),t.gl.vertexAttribPointer(i,3,t.gl.FLOAT,!1,0,0),tg=await d("sky"),i=t.gl.getAttribLocation(t_.shaderProgram,"in_pos"),r=t.gl.createBuffer(),t.gl.bindBuffer(t.gl.ARRAY_BUFFER,r),t.gl.bufferData(t.gl.ARRAY_BUFFER,new Float32Array(tm),t.gl.STATIC_DRAW),t.gl.enableVertexAttribArray(i),t.gl.vertexAttribPointer(i,3,t.gl.FLOAT,!1,0,0),tc=3*o.frameW,tw=3*o.frameH,ty=t.gl.createTexture(),t.gl.bindTexture(t.gl.TEXTURE_2D,ty),t.gl.texImage2D(t.gl.TEXTURE_2D,0,t.gl.RGBA,tc,tw,0,t.gl.RGBA,t.gl.UNSIGNED_BYTE,null),t.gl.texParameteri(t.gl.TEXTURE_2D,t.gl.TEXTURE_MIN_FILTER,t.gl.LINEAR),tP=t.gl.createRenderbuffer(),t.gl.bindRenderbuffer(t.gl.RENDERBUFFER,tP),t.gl.renderbufferStorage(t.gl.RENDERBUFFER,t.gl.DEPTH_COMPONENT16,tc,tw),tx=t.gl.createFramebuffer(),t.gl.bindFramebuffer(t.gl.FRAMEBUFFER,tx),t.gl.framebufferTexture2D(t.gl.FRAMEBUFFER,t.gl.COLOR_ATTACHMENT0,t.gl.TEXTURE_2D,ty,0),t.gl.framebufferRenderbuffer(t.gl.FRAMEBUFFER,t.gl.DEPTH_ATTACHMENT,t.gl.RENDERBUFFER,tP),t.gl.bindVertexArray(null)}class tU{constructor(t,i){this.init=t,this.render=i}}let tA,tb,tR=[];async function tz(){tv(tE,tp),tv(p,L),tv(z,R),tv(V,F),tv(N,M),tv(Z,O),tv(tl,ta),tv(tn,ts),tv(ti,tt);for(let t=0;t<tR.length;t++)await tR[t].init()}function tv(t,i){tR.push(new tU(t,i))}t.gl=void 0,window.addEventListener("load",()=>{function i(t){var i=t.changedTouches[0],r="";switch(t.type){case"touchstart":r="mousedown";break;case"touchmove":r="mousemove";break;case"touchend":r="mouseup";break;default:return}var e=document.createEvent("MouseEvent");e.initMouseEvent(r,!0,!0,window,1,i.screenX,i.screenY,i.clientX,i.clientY,!1,!1,!1,!1,0,null),i.target.dispatchEvent(e),t.preventDefault()}tA=document.getElementById("glCanvas"),t.gl=tA.getContext("webgl2"),tb=document.getElementById("coords"),tT(),window.onmousemove=a,window.onmouse=a,window.onmousedown=l,window.onmouseup=_,window.addEventListener("contextmenu",t=>t.preventDefault()),window.addEventListener("wheel",t=>{var i;i=t,h.dz=i.deltaY}),window.onscroll=()=>window.scroll(0,0),window.addEventListener("keyup",t=>{var i;n[(i=t).key]=0}),window.addEventListener("keydown",t=>{var i;n[(i=t).key]=1}),document.querySelector("#file").addEventListener("change",Y),document.addEventListener("touchstart",i,!0),document.addEventListener("touchmove",i,!0),document.addEventListener("touchend",i,!0),document.addEventListener("touchcancel",i,!0)});let t3=()=>{t.gl.clearColor(.8,.47,.3,1),t.gl.clear(t.gl.COLOR_BUFFER_BIT|t.gl.DEPTH_BUFFER_BIT),tA.width=window.innerWidth,tA.height=window.innerHeight,$(),o.frameW=tA.width,o.frameH=tA.height,o.camSet(o.loc,o.at,o.up),tb.innerHTML="LocX: "+o.loc.x.toString().slice(0,5)+" LocY: "+o.loc.y.toString().slice(0,5)+" LocZ: "+o.loc.z.toString().slice(0,5)+"<br /> Dir X: "+o.dir.x.toString().slice(0,5)+" Dir Y: "+o.dir.y.toString().slice(0,5)+" Dir Z: "+o.dir.z.toString().slice(0,5)+"<br /> Up X: "+o.up.x.toString().slice(0,5)+" Up Y: "+o.up.y.toString().slice(0,5)+" Up Z: "+o.up.z.toString().slice(0,5)+"<br /> At X: "+o.at.x.toString().slice(0,5)+" At Y: "+o.at.y.toString().slice(0,5)+" At Z: "+o.at.z.toString().slice(0,5)+"<br />",tR.forEach(t=>{t.render()}),h.dx=h.dy=h.dz=0,window.requestAnimationFrame(t3)};async function tT(){t.gl.clearColor(1,1,0,1),t.gl.clear(t.gl.COLOR_BUFFER_BIT),t.gl.enable(t.gl.DEPTH_TEST),t.gl.viewport(0,0,t.gl.canvas.width,t.gl.canvas.height),tA.width=window.innerWidth,tA.height=window.innerHeight,$(),o.frameW=tA.width,o.frameH=tA.height,o.camSet(o.loc,o.at,o.up),await d("default"),await tz(),t3()}t.initGL=tT}({});
